---
title: "Lab 7 assignment, group 24"
author: "Group 24"
format: html
editor: visual
---

## Group 24

**Group members:**

Helena Utzon , S153655

Christian Hussing, S150251

Pernille Renkwitz, s204637

Inmaculada Echegoyan Venegas, s253701

Lanjing Buisan Fernandez, s256855

### Plan for report

Data: gravier

Import and data wrangling:

Analysis: Everyone contributes with a graph or something else

### Load libraries

```{r}
#| message: false  
library(tidyverse) 
library(broom) 
library(ggrepel)
```

### Load data

Load data:

```{r}
raw_dir <- "data/"
data_file <- "gravier.RData"
data_loc <- "https://github.com/ramhiser/datamicroarray/raw/master/data/"

if( !dir.exists(raw_dir) ){
  dir.create(path = raw_dir)
}
if( !file.exists(str_c(raw_dir, data_file)) ){
  download.file(
    url = str_c(data_loc, data_file),
    destfile = str_c(raw_dir, data_file))
}
load(file = str_c(raw_dir, data_file))
```

Clean and augment data:

```{r}
gravier_clean <- gravier |>
  bind_cols() |>
  as_tibble()

gravier_clean_aug <- gravier_clean |>
  mutate(y = case_when(y == "poor" ~ 1,
                       y == "good" ~ 0)) |> 
  relocate(early_metastasis = y)
```

### Data wrangling

The data is transformed to long data:

```{r}
gravier_clean_aug_long <- gravier_clean_aug |> 
  pivot_longer(
  cols = starts_with("g"),
  names_to = "gene",
  values_to = "log2_expr_level"
  )
```

#### Investigation of data: Are expression levels normally distributed?

The expression level distribution of four genes were visualized:

```{r}
onlyg1 <- gravier_clean_aug_long |>
  filter(gene == "g1A01" | gene == "g1E02" | gene == "g1E03" | gene == "g1E04")

ggplot(onlyg1, aes(log2_expr_level)) +
  geom_histogram() +
  facet_wrap(~gene ~early_metastasis, nrow = 2, dir = "v") +
  labs(title = "Distribution of four genes", 
       subtitle = "0 : Patients without early metastasis, 1 : Patients with early metastasis")
```

The distribution of three of the genes seemed normally distributed, while the last gene had a distribution skewed towards higher expression level for both patients with and without early metastasis.

#### Impact of g1E02 expression on prognosis

```{r}
ggplot(data = gravier_clean, aes(x = g1E02, fill = y)) +
  geom_density(alpha = 0.6) +
  scale_fill_viridis_d() +
  theme_minimal() +
  labs(title = "Prognostic DNA signature of T1T2 node-negative breast cancer patients",
       x = "Expression of g1E02 (log2 transformed)", 
       fill = "Outcome")


```

The graph shows the expression of g1E02 in patients without- and with early metastasis (labelled good and poor). It shows that patients with early metastasis generally had a lower expression of g1E02 compared to patients who did not have early metastasis.
